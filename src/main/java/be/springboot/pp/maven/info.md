# Maven Overview

## Dependencies
Dependencies are external third-party code libraries that provide desired code and algorithms in a project.

### Ways to Include Dependencies
- **Manual Code Copying:** Copy the necessary code directly into the project.
  - **drawback:** Will receive no automatic updates made to that source code.
  - **drawback:** may require manually resolving addition dependencies
- **Using JAR Files:** Download a JAR file and add it to the project (e.g., to add extra JAR in IntelliJ IDEA: File > Project Structure > Libraries. Those files will be added in "External libraries" folder and will be placed on the application classpath).
  - **Drawbacks:** You may need to manually download and include other dependent JAR files.
- **Using Maven:** Automates dependency management, downloads required libraries, resolves transitive dependencies, and updates them when necessary.

## Introduction
Maven is a build automation tool that simplifies project management by handling dependencies and their classpath, managing project structure and versions, and automating tasks like compilation, packaging, and deployment. It also manages repositories and plugins, streamlining a project's lifecycle.

## Key concepts
- **POM (Project Object Model):** The `pom.xml` file is the heart of a Maven project. It is a centralized project configuration. It defines project configurations like dependencies, plugins, goals and build configurations.
- **Dependencies:** Maven helps manage external libraries your project depends on. You can specify a dependency in the `pom.xml` file and maven will fetch it from a remote repository.
- **Repositories:** Maven retrieves dependencies from repositories -
  - **Local repository:** Stored on your local machine. It's path is `~/Users/<username>/.m2/repository`.
  - **Central repository:** The default remote repository hosted on the internet at domain https://mvnrepository.com/. We can copy dependency details fro this site and put it in our pom.xml file and maven will download and include that dependency on classpath for us.
  - **Remote Repository:** custom (maybe private) remote repositories defined in `pom.xml`.

## Goals and Phases
A **goal** is a specific task that Maven can execute, such as compiling or packaging. **Phases** group these goals into steps in the build lifecycle.

## Plugins
Maven uses plugins to perform tasks. For example:
- **Compiler Plugin**: `maven-compiler-plugin` compiles Java source code.
- **Surefire Plugin**: `maven-surefire-plugin` runs unit tests
- **JAR plugin**: `maven-jar-plugin` for building JAR files.
- **Shade Plugin**: packages the project into a "fat JAR" with dependencies.

## Maven's Project Lifecycle
Maven has a standard build lifecycle made up of the following phases:
- `clean`:
- `validate`: ensure the project structure is correct and verify all required information is available.
- `compile`: compile the source code.
- `test`: run unit tests using a testing framework like JUnit or TestNG.
- `package`: package the compiled code into a distributable format (e.g., into a JAR or WAR file).
- `verify`: perform checks to ensure the package is valid and meets quality criteria.
- `install`: install the packaged artifact to the local repository.
- `site`:
- `deploy`: copy the final package to a remote repository for sharing.

These key lifecycles phases can be grouped into three broad categories -
- **Clean Lifecycle**: Cleans the project by deleting files created during previous builds.
- **Default Lifecycle**: Handles build and deployment of the project.
- **Site Lifecycle**: generates project documentation and reports.

## configuring maven in a project
- install maven in your machine
- setup a `pom.xml` file in the root of your project directory
- specify project dependencies, plugins, and repositories in `pom.xml` file
- Run maven goals from the command line to execute the build lifecycle.

## core maven commands
- `mvn clean`: removes all files generated by previous builds.
- `mvn compile`: compiles the source code
- `mvn test`: runs the unit tests.
- `mvn package`: packages the project
- `mvn install`: installs package into your local repository
- `mvn deploy`: deploys the project to a remote repository.

## Sample `pom.xml`
```xml
<!-- The root element that encapsulates the entire POM file -->
<project xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xmlns="http://maven.apache.org/POM/4.0.0"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 
                             http://maven.apache.org/xsd/maven-4.0.0.xsd">

    <!-- specifies the version of the POM model, which is usually `4.0.0` -->
    <modelVersion>4.0.0</modelVersion>

    <!-- defines the group or organization that the project belongs to (like a package name) -->
    <groupId>com.example</groupId> <!-- organization/company name in reverse -->
    <artifactId>my-app</artifactId> <!-- The name of the project/module (artifact), typically the JAR or WAR file name. -->
    <version>1.0-SNAPSHOT</version> <!-- defines the version of the project -->

    <parent> <!-- parent POM that sets up common project dependencies and plugins -->
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>2.1.3.RELEASE</version>
        <relativePath/>
    </parent>

    <properties> <!-- used to define custom projects properties, which can be reused in other parts of the `pom.xml` file -->
        <jacoco.version>0.8.3</jacoco.version>
        <maven.compiler.source>1.8</maven.compiler.source>
        <maven.compiler.target>1.8</maven.compiler.target>
    </properties>

    <dependencies> <!-- the list of dependencies (external libraries) the project requires -->
        <!-- Adding a dependency to a logging library -->
        <dependency>
            <groupId>org.slf4j</groupId>
            <artifactId>slf4j-api</artifactId>
            <version>1.7.30</version>
          <scope>test</scope>
        </dependency>
    </dependencies>

    <repositories> <!-- defines remote repositories for downloading dependencies -->
        <repository>
            <id>central</id>
            <name>Central Repository</name>
            <url>https://repo.maven.apache.org/maven2</url>
            <layout>default</layout>
            <snapshots>
              <enabled>false</enabled>
            </snapshots>
        </repository>
        <repository>
            <id>com.bharatpe-snapshot</id>
            <name>snapshot</name>
            <url>s3://maven-repo.bharatpe.in/snapshot</url>
        </repository>
        <repository>
            <id>com.bharatpe-release</id>
            <name>release</name>
            <url>s3://maven-repo.bharatpe.in/release</url>
        </repository>
    </repositories>
  
   <dependencyManagement>
     <!-- put transitive dependency to resolve dependency conflict forcefully -->
   </dependencyManagement>

    <distributionManagement> <!-- used to manage distribution in the build process -->
        <repository>
            <id>aws-release</id>
            <name>AWS Release Repository</name>
            <url>s3://maven-repo.bharatpe.in/release</url>
        </repository>
        <snapshotRepository>
            <id>aws-snapshot</id>
            <name>AWS Snapshot Repository</name>
            <url>s3://maven-repo.bharatpe.in/snapshot</url>
        </snapshotRepository>
    </distributionManagement>
  
    <pluginManagement> <!-- used to manage plugins in the build process -->
        <plugins>
            <plugin>
               <groupId>org.sonarsource.scanner.maven</groupId>
               <artifactId>sonar-maven-plugin</artifactId>
               <version>3.7.0.1746</version>
            </plugin>
        </plugins>
    </pluginManagement>

    <build> <!-- contains build-specific configurations such as the location of source files or build plugins -->
        <sourceDirectory>src/main/java</sourceDirectory>

        <extensions>
            <extension>
              <groupId>com.github.platform-team</groupId>
              <artifactId>aws-maven</artifactId>
              <version>6.0.0</version>
            </extension>
        </extensions>
      
        <plugins>
            <!-- Compiler plugin -->
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-compiler-plugin</artifactId>
                <version>3.8.1</version>
                <configuration>
                    <source>11</source>
                    <target>11</target>
                </configuration>
            </plugin>
        </plugins>
    </build>
</project>
```

## Maven Dependency Scope
denoted by <scope></scope> in pom.xml file, to be put in <dependency></dependency>
- **compile**: (default) dependencies required for project compilation.
- **provided**: dependencies needed for compilation but not packaged (e.g. web apps)
- **runtime**: dependencies required only at runtime
- **test**: dependencies needed for testing but not for the final build.
- **system**: similar to provided but you must explicitly provide the JAR file.

## configuring multi-module project
**Objective:** Put `common` module as a dependency in `feature` project.
- create `common` project and write necessary code.
- use `mvn install` to install package in local repository
- include `common` project's groupId, artifactId and version in `feature` project under dependencies.

## Miscellaneous
- **Profiles**: Maven profiles allow you to define different build configurations based on the environment (e.g., dev, test, production)
- **Parent POM**: Useful for managing multiple Maven projects. You can define a parent POM that sets up common dependencies and plugins.
- **Multi-Module Projects**: in large projects, you can split your project into several modules that share a parent POM.
- **Maven Wrapper (mvnw)**: It allows you to ship your project with a Maven binary so developers don't need to install Maven manually.
- **Transitive dependencies**: Maven automatically resolves dependencies of dependencies. If you depend on Library A, and Library A depends on Library B, Maven will automatically download Library B as well.

## What can go wrong
- direct dependencies depending on different versions of same transitive dependency. Termed as **Dependency conflict**. During DFS, project version at a lower depth will be considered. And if both are on same level, then the one found first will be considered.
- Never make transitive dependencies as direct dependency until you actually need it, just to resolve conflicts. Otherwise it might conflict in your other direct dependencies which were using it internally.
- 